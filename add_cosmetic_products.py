"""–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∫–æ—Å–º–µ—Ç–∏–∫–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏."""
import asyncio
import os
from decimal import Decimal
from pathlib import Path
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine
from sqlalchemy.orm import sessionmaker
import httpx
from typing import Optional

from app.config import settings
from app.services.business_service import BusinessService
from app.services.category_service import CategoryService
from app.services.product_service import ProductService


async def upload_image(image_path: str, base_url: str) -> Optional[str]:
    """–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ–ª—É—á–∏—Ç—å URL."""
    if not os.path.exists(image_path):
        print(f"‚ö†Ô∏è  –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: {image_path}")
        return None
    
    try:
        async with httpx.AsyncClient(timeout=30.0) as client:
            with open(image_path, 'rb') as f:
                files = {'file': (os.path.basename(image_path), f, 'image/png')}
                response = await client.post(
                    f"{base_url}/api/v1/images/upload",
                    files=files,
                )
                
            if response.status_code == 200:
                data = response.json()
                image_url = data.get('url') or data.get('file_url')
                if image_url:
                    # –ï—Å–ª–∏ —ç—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    if image_url.startswith('/'):
                        return image_url
                    return image_url
                print(f"‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL –∏–∑ –æ—Ç–≤–µ—Ç–∞: {response.json()}")
                return None
            else:
                print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è {image_path}: {response.status_code} - {response.text}")
                return None
    except Exception as e:
        print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ {image_path}: {e}")
        return None


async def add_cosmetic_products():
    """–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –∫–æ—Å–º–µ—Ç–∏–∫–∏."""
    
    business_slug = "hair-cosmetics"
    base_url = settings.base_url if hasattr(settings, 'base_url') else "http://localhost:8000"
    
    # –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞)
    # __file__ = backend/add_cosmetic_products.py
    # parent.parent = –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ (GNA_tg_store)
    images_dir = Path(__file__).parent.parent / "images"
    
    # –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
    engine = create_async_engine(settings.database_url, echo=False)
    async_session = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)
    
    async with async_session() as db:
        business_service = BusinessService(db)
        category_service = CategoryService(db)
        product_service = ProductService(db)
        
        # –ü–æ–ª—É—á–∞–µ–º –±–∏–∑–Ω–µ—Å
        business = await business_service.get_by_slug(business_slug)
        if not business:
            print(f"‚ùå –ë–∏–∑–Ω–µ—Å '{business_slug}' –Ω–µ –Ω–∞–π–¥–µ–Ω! –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ create_hair_cosmetics_business.py")
            await engine.dispose()
            return
        
        print(f"‚úÖ –ù–∞–π–¥–µ–Ω –±–∏–∑–Ω–µ—Å: {business.name} (slug: {business.slug})")
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        existing_categories = await category_service.get_by_business_slug(business_slug)
        category_map = {cat.name: cat for cat in existing_categories}
        
        # –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é "–ú–∞—Å–∫–∏ –¥–ª—è –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å", –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
        if "–ú–∞—Å–∫–∏ –¥–ª—è –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å" not in category_map:
            category = await category_service.create(
                business_id=business.id,
                name="–ú–∞—Å–∫–∏ –¥–ª—è –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å",
                position=7,
                surcharge=Decimal("0.00"),
            )
            category_map["–ú–∞—Å–∫–∏ –¥–ª—è –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å"] = category
            print(f"‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è: {category.name}")
        else:
            print(f"‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: –ú–∞—Å–∫–∏ –¥–ª—è –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å")
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é "–ú–∞—Å–∫–∏ –¥–ª—è –≤–æ–ª–æ—Å" –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º
        if "–ú–∞—Å–∫–∏ –¥–ª—è –≤–æ–ª–æ—Å" not in category_map:
            category = await category_service.create(
                business_id=business.id,
                name="–ú–∞—Å–∫–∏ –¥–ª—è –≤–æ–ª–æ—Å",
                position=3,
                surcharge=Decimal("0.00"),
            )
            category_map["–ú–∞—Å–∫–∏ –¥–ª—è –≤–æ–ª–æ—Å"] = category
            print(f"‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è: {category.name}")
        else:
            print(f"‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: –ú–∞—Å–∫–∏ –¥–ª—è –≤–æ–ª–æ—Å")
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        print(f"\nüì∏ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...")
        image_files = [
            "image.png",
            "image (1).png",
            "image (2).png",
            "image (3).png",
            "image (4).png",
            "image (5).png",
        ]
        
        print(f"  –ò—â—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤: {images_dir.absolute()}")
        print(f"  –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {images_dir.exists()}")
        if images_dir.exists():
            print(f"  –§–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: {[f.name for f in images_dir.iterdir() if f.is_file()]}")
        
        uploaded_images = []
        for img_file in image_files:
            img_path = images_dir / img_file
            print(f"  –ü—Ä–æ–≤–µ—Ä—è—é –ø—É—Ç—å: {img_path.absolute()}")
            if img_path.exists():
                print(f"  –ó–∞–≥—Ä—É–∂–∞—é {img_file}...")
                url = await upload_image(str(img_path), base_url)
                if url:
                    uploaded_images.append(url)
                    print(f"  ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {url}")
                else:
                    print(f"  ‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å {img_file}")
                    uploaded_images.append(None)
            else:
                print(f"  ‚ö†Ô∏è  –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {img_path.absolute()}")
                uploaded_images.append(None)
        
        # –¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (6 —Ç–æ–≤–∞—Ä–æ–≤: –ø–µ—Ä–≤—ã–µ 3 –≤ –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –≤—Ç–æ—Ä—ã–µ 3 –≤ –¥—Ä—É–≥—É—é)
        products_data = [
            # –ü–µ—Ä–≤—ã–µ 3 —Ç–æ–≤–∞—Ä–∞ - KLOR MASK –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é "–ú–∞—Å–∫–∏ –¥–ª—è –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å"
            {
                "title": "KLOR MASK 250 –º–ª",
                "description": "–ú–∞—Å–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ –∑–∞—â–∏—â–∞–µ—Ç —Ü–≤–µ—Ç –æ—Ç –≤—ã–º—ã–≤–∞–Ω–∏—è, –æ–∂–∏–≤–ª—è–µ—Ç –∏ –ø—Ä–∏–¥–∞–µ—Ç –≤–æ–ª–æ—Å–∞–º –±–ª–µ—Å–∫. –ú–∞—Å–ª–æ –º–∞–∫–∞–¥–∞–º–∏–∏ –≤ —Å–æ—Å—Ç–∞–≤–µ –º–∞—Å–∫–∏ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –ø–∏—Ç–∞–Ω–∏—é –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –≤–æ–ª–æ—Å —Ä–∞–∑–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è, –ø—Ä–∏–¥–∞–µ—Ç –≤–æ–ª–æ—Å–∞–º –º—è–≥–∫–æ—Å—Ç—å –∏ —à–µ–ª–∫–æ–≤–∏—Å—Ç–æ—Å—Ç—å. –ê –±–ª–∞–≥–æ–¥–∞—Ä—è –º–∞—Å–ª—É –º–∞—Ä—É–ª—ã –∏ —ç–∫—Å—Ç—Ä–∞–∫—Ç—É –æ–≥—É—Ä—Ü–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤–ª–∞–≥–∞ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–æ–ª–æ—Å–∞. –¢–∞–∫ –∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ü–≤–µ—Ç –æ—Ç –≤—ã–≥–æ—Ä–∞–Ω–∏—è –Ω–∞ —Å–æ–ª–Ω—Ü–µ –±–ª–∞–≥–æ–¥–∞—Ä—è UF-—Ñ–∏–ª—å—Ç—Ä–∞–º –≤ —Å–æ—Å—Ç–∞–≤–µ –º–∞—Å–∫–∏.",
                "sku": "KOKMSKLOR250",
                "category": "–ú–∞—Å–∫–∏ –¥–ª—è –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å",
                "image_index": 0,  # image.png
                "price": Decimal("1200.00"),
            },
            {
                "title": "KLOR MASK 500 –º–ª",
                "description": "–ú–∞—Å–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ –∑–∞—â–∏—â–∞–µ—Ç —Ü–≤–µ—Ç –æ—Ç –≤—ã–º—ã–≤–∞–Ω–∏—è, –æ–∂–∏–≤–ª—è–µ—Ç –∏ –ø—Ä–∏–¥–∞–µ—Ç –≤–æ–ª–æ—Å–∞–º –±–ª–µ—Å–∫. –ú–∞—Å–ª–æ –º–∞–∫–∞–¥–∞–º–∏–∏ –≤ —Å–æ—Å—Ç–∞–≤–µ –º–∞—Å–∫–∏ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –ø–∏—Ç–∞–Ω–∏—é –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –≤–æ–ª–æ—Å —Ä–∞–∑–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è, –ø—Ä–∏–¥–∞–µ—Ç –≤–æ–ª–æ—Å–∞–º –º—è–≥–∫–æ—Å—Ç—å –∏ —à–µ–ª–∫–æ–≤–∏—Å—Ç–æ—Å—Ç—å. –ê –±–ª–∞–≥–æ–¥–∞—Ä—è –º–∞—Å–ª—É –º–∞—Ä—É–ª—ã –∏ —ç–∫—Å—Ç—Ä–∞–∫—Ç—É –æ–≥—É—Ä—Ü–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤–ª–∞–≥–∞ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–æ–ª–æ—Å–∞. –¢–∞–∫ –∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ü–≤–µ—Ç –æ—Ç –≤—ã–≥–æ—Ä–∞–Ω–∏—è –Ω–∞ —Å–æ–ª–Ω—Ü–µ –±–ª–∞–≥–æ–¥–∞—Ä—è UF-—Ñ–∏–ª—å—Ç—Ä–∞–º –≤ —Å–æ—Å—Ç–∞–≤–µ –º–∞—Å–∫–∏.",
                "sku": "KOKMSKLOR500",
                "category": "–ú–∞—Å–∫–∏ –¥–ª—è –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å",
                "image_index": 1,  # image (1).png
                "price": Decimal("1400.00"),
            },
            {
                "title": "KLOR MASK",
                "description": "–ú–∞—Å–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ –∑–∞—â–∏—â–∞–µ—Ç —Ü–≤–µ—Ç –æ—Ç –≤—ã–º—ã–≤–∞–Ω–∏—è, –æ–∂–∏–≤–ª—è–µ—Ç –∏ –ø—Ä–∏–¥–∞–µ—Ç –≤–æ–ª–æ—Å–∞–º –±–ª–µ—Å–∫. –ú–∞—Å–ª–æ –º–∞–∫–∞–¥–∞–º–∏–∏ –≤ —Å–æ—Å—Ç–∞–≤–µ –º–∞—Å–∫–∏ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –ø–∏—Ç–∞–Ω–∏—é –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –≤–æ–ª–æ—Å —Ä–∞–∑–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è, –ø—Ä–∏–¥–∞–µ—Ç –≤–æ–ª–æ—Å–∞–º –º—è–≥–∫–æ—Å—Ç—å –∏ —à–µ–ª–∫–æ–≤–∏—Å—Ç–æ—Å—Ç—å. –ê –±–ª–∞–≥–æ–¥–∞—Ä—è –º–∞—Å–ª—É –º–∞—Ä—É–ª—ã –∏ —ç–∫—Å—Ç—Ä–∞–∫—Ç—É –æ–≥—É—Ä—Ü–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤–ª–∞–≥–∞ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–æ–ª–æ—Å–∞. –¢–∞–∫ –∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ü–≤–µ—Ç –æ—Ç –≤—ã–≥–æ—Ä–∞–Ω–∏—è –Ω–∞ —Å–æ–ª–Ω—Ü–µ –±–ª–∞–≥–æ–¥–∞—Ä—è UF-—Ñ–∏–ª—å—Ç—Ä–∞–º –≤ —Å–æ—Å—Ç–∞–≤–µ –º–∞—Å–∫–∏.",
                "sku": "KOKMSKLOR",
                "category": "–ú–∞—Å–∫–∏ –¥–ª—è –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å",
                "image_index": 2,  # image (2).png
                "price": Decimal("1200.00"),
            },
            # –í—Ç–æ—Ä—ã–µ 3 —Ç–æ–≤–∞—Ä–∞ - KBYO/MSKA MASK –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é "–ú–∞—Å–∫–∏ –¥–ª—è –≤–æ–ª–æ—Å"
            {
                "title": "KBYO/MSKA MASK 250 –º–ª",
                "description": "–í–ù–ò–ú–ê–ù–ò–ï! –£ –ù–û–í–û–ô –ü–ê–†–¢–ò–ò –ú–ê–°–û–ö KBYO 500–ú–õ - –ì–õ–Ø–ù–¶–ï–í–´–ï –ö–†–´–®–ö–ò. –ú–∞—Å–∫–∏ —Å —Ç–∞–∫–∏–º–∏ –∫—Ä—ã—à–∫–∞–º–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –±—Ä–∞–∫–æ–º –∏–ª–∏ –ø–æ–¥–¥–µ–ª–∫–æ–π.\n\n–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ª–∏–ø–∏–¥–Ω–æ-—Å–∏–ª–∏–∫–æ–Ω–æ–≤–∞—è –º–∞—Å–∫–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–∞–∫ –≤ –¥–æ–º–∞—à–Ω–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö —Ç–∞–∫ –∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–∞–ª–æ–Ω–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —É—Ö–æ–¥–æ–≤–æ–≥–æ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞. –ú–∞—Å–∫–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç, –ø–∏—Ç–∞–µ—Ç, —É–≤–ª–∞–∂–Ω—è–µ—Ç –∏ –ø—Ä–∏–¥–∞–µ—Ç —à–µ–ª–∫–æ–≤–∏—Å—Ç–æ—Å—Ç—å –∏ –±–ª–µ—Å–∫ –≤–æ–ª–æ—Å–∞–º, —Å–æ–∑–¥–∞–µ—Ç –∑–∞—â–∏—Ç–Ω—ã–µ –ø–ª–µ–Ω–∫–∏ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ—Å–∞, –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –æ—Ç –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã –∏ –æ–±–ª–µ–≥—á–∞–µ—Ç —Ä–∞—Å—á–µ—Å—ã–≤–∞–Ω–∏–µ. –ì–∏–¥—Ä–æ–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–æ–µ–≤—ã–π –ø—Ä–æ—Ç–µ–∏–Ω, —ç–∫—Å—Ç—Ä–∞–∫—Ç –æ–≥—É—Ä—Ü–∞ –∏ –º–∞—Å–ª–æ –º–∞—Ä—É–ª—ã –æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–∏–ª—å–Ω–æ–µ —É–≤–ª–∞–∂–Ω—è—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ. –ë–∏–æ—Ç–∏–Ω –≤ —Å–æ—Å—Ç–∞–≤–µ –ø—Ä–∏–¥–∞–µ—Ç –≤–æ–ª–æ—Å–∞–º –ø—Ä–æ—á–Ω–æ—Å—Ç—å.",
                "sku": "KOMSKBYO250",
                "category": "–ú–∞—Å–∫–∏ –¥–ª—è –≤–æ–ª–æ—Å",
                "image_index": 3,  # image (3).png
                "price": Decimal("1100.00"),
            },
            {
                "title": "KBYO/MSKA MASK 500 –º–ª",
                "description": "–í–ù–ò–ú–ê–ù–ò–ï! –£ –ù–û–í–û–ô –ü–ê–†–¢–ò–ò –ú–ê–°–û–ö KBYO 500–ú–õ - –ì–õ–Ø–ù–¶–ï–í–´–ï –ö–†–´–®–ö–ò. –ú–∞—Å–∫–∏ —Å —Ç–∞–∫–∏–º–∏ –∫—Ä—ã—à–∫–∞–º–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –±—Ä–∞–∫–æ–º –∏–ª–∏ –ø–æ–¥–¥–µ–ª–∫–æ–π.\n\n–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ª–∏–ø–∏–¥–Ω–æ-—Å–∏–ª–∏–∫–æ–Ω–æ–≤–∞—è –º–∞—Å–∫–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–∞–∫ –≤ –¥–æ–º–∞—à–Ω–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö —Ç–∞–∫ –∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–∞–ª–æ–Ω–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —É—Ö–æ–¥–æ–≤–æ–≥–æ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞. –ú–∞—Å–∫–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç, –ø–∏—Ç–∞–µ—Ç, —É–≤–ª–∞–∂–Ω—è–µ—Ç –∏ –ø—Ä–∏–¥–∞–µ—Ç —à–µ–ª–∫–æ–≤–∏—Å—Ç–æ—Å—Ç—å –∏ –±–ª–µ—Å–∫ –≤–æ–ª–æ—Å–∞–º, —Å–æ–∑–¥–∞–µ—Ç –∑–∞—â–∏—Ç–Ω—ã–µ –ø–ª–µ–Ω–∫–∏ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ—Å–∞, –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –æ—Ç –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã –∏ –æ–±–ª–µ–≥—á–∞–µ—Ç —Ä–∞—Å—á–µ—Å—ã–≤–∞–Ω–∏–µ. –ì–∏–¥—Ä–æ–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–æ–µ–≤—ã–π –ø—Ä–æ—Ç–µ–∏–Ω, —ç–∫—Å—Ç—Ä–∞–∫—Ç –æ–≥—É—Ä—Ü–∞ –∏ –º–∞—Å–ª–æ –º–∞—Ä—É–ª—ã –æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–∏–ª—å–Ω–æ–µ —É–≤–ª–∞–∂–Ω—è—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ. –ë–∏–æ—Ç–∏–Ω –≤ —Å–æ—Å—Ç–∞–≤–µ –ø—Ä–∏–¥–∞–µ—Ç –≤–æ–ª–æ—Å–∞–º –ø—Ä–æ—á–Ω–æ—Å—Ç—å.",
                "sku": "KOMSKBYO500",
                "category": "–ú–∞—Å–∫–∏ –¥–ª—è –≤–æ–ª–æ—Å",
                "image_index": 4,  # image (4).png
                "price": Decimal("1300.00"),
            },
            {
                "title": "KBYO/MSKA MASK 2000 –º–ª",
                "description": "–í–ù–ò–ú–ê–ù–ò–ï! –£ –ù–û–í–û–ô –ü–ê–†–¢–ò–ò –ú–ê–°–û–ö KBYO 500–ú–õ - –ì–õ–Ø–ù–¶–ï–í–´–ï –ö–†–´–®–ö–ò. –ú–∞—Å–∫–∏ —Å —Ç–∞–∫–∏–º–∏ –∫—Ä—ã—à–∫–∞–º–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –±—Ä–∞–∫–æ–º –∏–ª–∏ –ø–æ–¥–¥–µ–ª–∫–æ–π.\n\n–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ª–∏–ø–∏–¥–Ω–æ-—Å–∏–ª–∏–∫–æ–Ω–æ–≤–∞—è –º–∞—Å–∫–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–∞–∫ –≤ –¥–æ–º–∞—à–Ω–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö —Ç–∞–∫ –∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–∞–ª–æ–Ω–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —É—Ö–æ–¥–æ–≤–æ–≥–æ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞. –ú–∞—Å–∫–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç, –ø–∏—Ç–∞–µ—Ç, —É–≤–ª–∞–∂–Ω—è–µ—Ç –∏ –ø—Ä–∏–¥–∞–µ—Ç —à–µ–ª–∫–æ–≤–∏—Å—Ç–æ—Å—Ç—å –∏ –±–ª–µ—Å–∫ –≤–æ–ª–æ—Å–∞–º, —Å–æ–∑–¥–∞–µ—Ç –∑–∞—â–∏—Ç–Ω—ã–µ –ø–ª–µ–Ω–∫–∏ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ—Å–∞, –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –æ—Ç –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã –∏ –æ–±–ª–µ–≥—á–∞–µ—Ç —Ä–∞—Å—á–µ—Å—ã–≤–∞–Ω–∏–µ. –ì–∏–¥—Ä–æ–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–æ–µ–≤—ã–π –ø—Ä–æ—Ç–µ–∏–Ω, —ç–∫—Å—Ç—Ä–∞–∫—Ç –æ–≥—É—Ä—Ü–∞ –∏ –º–∞—Å–ª–æ –º–∞—Ä—É–ª—ã –æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–∏–ª—å–Ω–æ–µ —É–≤–ª–∞–∂–Ω—è—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ. –ë–∏–æ—Ç–∏–Ω –≤ —Å–æ—Å—Ç–∞–≤–µ –ø—Ä–∏–¥–∞–µ—Ç –≤–æ–ª–æ—Å–∞–º –ø—Ä–æ—á–Ω–æ—Å—Ç—å.",
                "sku": "KOMSKBYO2000",
                "category": "–ú–∞—Å–∫–∏ –¥–ª—è –≤–æ–ª–æ—Å",
                "image_index": 5,  # image (5).png
                "price": Decimal("1900.00"),
            },
        ]
        
        print(f"\nüõçÔ∏è  –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤...")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã
        existing_products = await product_service.get_by_business_slug(
            business_slug,
            include_inactive=True,
        )
        existing_skus = {p.sku for p in existing_products if p.sku}
        
        for product_data in products_data:
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if product_data["sku"] in existing_skus:
                print(f"‚ö†Ô∏è  –¢–æ–≤–∞—Ä —Å SKU '{product_data['sku']}' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                continue
            
            category = category_map[product_data["category"]]
            category_ids = [category.id]
            
            # –ü–æ–ª—É—á–∞–µ–º URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            image_url = None
            if product_data["image_index"] < len(uploaded_images):
                image_url = uploaded_images[product_data["image_index"]]
            
            # –°–æ–∑–¥–∞–µ–º —Ç–æ–≤–∞—Ä
            product_id = await product_service.create(
                business_id=business.id,
                title=product_data["title"],
                description=product_data.get("description"),
                price=product_data["price"],
                currency="RUB",
                sku=product_data["sku"],
                image_url=image_url,
                variations=None,  # –ë–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∫–∞–∂–¥—ã–π —Ä–∞–∑–º–µ—Ä - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–æ–≤–∞—Ä
                category_ids=category_ids,
            )
            
            # –ü–æ–ª—É—á–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            product = await product_service.get_by_id(product_id)
            
            if product:
                print(f"‚úÖ –°–æ–∑–¥–∞–Ω —Ç–æ–≤–∞—Ä: {product.title} (SKU: {product.sku}) - {product.price} ‚ÇΩ")
                if image_url:
                    print(f"   –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {image_url}")
            else:
                print(f"‚úÖ –°–æ–∑–¥–∞–Ω —Ç–æ–≤–∞—Ä: {product_data['title']} (SKU: {product_data['sku']}) - {product_data['price']} ‚ÇΩ")
        
        print(f"\n‚úÖ –¢–æ–≤–∞—Ä—ã —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã!")
    
    await engine.dispose()


if __name__ == "__main__":
    print("üöÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∫–æ—Å–º–µ—Ç–∏–∫–∏...\n")
    asyncio.run(add_cosmetic_products())




